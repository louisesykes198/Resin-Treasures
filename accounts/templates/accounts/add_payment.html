{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">Add Payment Method</h2>

  <form id="payment-form" method="POST" action="{% url 'add_payment_method' %}">
    {% csrf_token %}
    <div class="mb-3">
      <label for="card-element" class="form-label">Card Details</label>
      <div id="card-element" class="form-control">
        <!-- Stripe will put the card input here -->
      </div>
    </div>

    <div id="card-errors" class="text-danger small mt-2"></div>

    <button id="submit-button" class="btn btn-primary mt-3">Save Card</button>
  </form>
</div>

<!-- Stripe JS -->
<script src="https://js.stripe.com/v3/"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const stripe = Stripe("{{ STRIPE_PUBLIC_KEY }}");
    const elements = stripe.elements();
    const card = elements.create("card", {
      style: {
        base: {
          fontSize: '16px',
          color: '#32325d',
          '::placeholder': {
            color: '#aab7c4'
          }
        },
        invalid: {
          color: '#fa755a',
          iconColor: '#fa755a'
        }
      }
    });
    card.mount("#card-element");

    const form = document.getElementById("payment-form");
    form.addEventListener("submit", async function (e) {
      e.preventDefault();
      const {token, error} = await stripe.createToken(card);
      if (error) {
        document.getElementById("card-errors").textContent = error.message;
      } else {
        const hiddenInput = document.createElement("input");
        hiddenInput.setAttribute("type", "hidden");
        hiddenInput.setAttribute("name", "stripeToken");
        hiddenInput.setAttribute("value", token.id);
        form.appendChild(hiddenInput);
        form.submit();
      }
    });
  });
</script>
{% endblock %}


