{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Resin Treasures</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap first -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <!-- Your custom styles last -->
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>

<body>

  <!-- === HEADER & NAVBAR === -->
  <header>
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
      <div class="container">

      <div class="fixed-logo">
  <a class="navbar-brand" href="{% url 'home' %}">
    <img src="{% static 'images/rt-logo-4.png' %}" alt="Resin Treasures Logo" class="logo" style="height: 50px;">
  </a>
</div>

        <!-- Hamburger -->
        <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
          data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Collapsible Menu -->
        <div class="collapse navbar-collapse" id="navbarNav">

          <!-- Centered Search Bar (desktop only) -->
<form class="d-none d-lg-flex mx-auto search-bar" method="get" action="{% url 'shop' %}" style="max-width: 500px; width: 100%;">
  <input 
    class="form-control me-2" 
    type="search" 
    placeholder="Search" 
    name="q" 
    style="flex-grow: 1; min-width: 0;"
  >
  <button 
    class="btn btn-outline-secondary" 
    type="submit" 
    style="height: 38px; width: 80px; min-width: 80px; padding: 0; font-size: 1rem;"
  >Go</button>
</form>

<!-- ✅ Wrap nav links inside UL -->
<ul class="navbar-nav ms-auto d-flex align-items-center">
    <li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
    <li class="nav-item"><a class="nav-link" href="{% url 'about' %}">About Us</a></li>

    <!-- Categories Dropdown -->
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="categoryDropdown" role="button"
           data-bs-toggle="dropdown" aria-expanded="false">Categories</a>
        <ul class="dropdown-menu" aria-labelledby="categoryDropdown">
            <li><a class="dropdown-item" href="{% url 'shop' %}">All Products</a></li>
            <li><hr class="dropdown-divider"></li>
            {% for category in all_categories %}
            <li>
                <a class="dropdown-item" href="{% url 'shop' %}?category={{ category.slug }}">
                    {{ category.name }}
                </a>
            </li>
            {% endfor %}
        </ul>
    </li>

    <li class="nav-item"><a class="nav-link" href="{% url 'contact' %}">Contact</a></li>

    {% if user.is_authenticated %}
        <!-- My Account Dropdown -->
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="accountDropdown" role="button"
               data-bs-toggle="dropdown" aria-expanded="false">
               My Account
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="accountDropdown">
            <li><a class="dropdown-item" href="{% url 'profile' %}">Profile</a></li>
            <li><a class="dropdown-item" href="{% url 'personal_details' %}">Personal Details</a></li>
            <li><a class="dropdown-item" href="{% url 'order_history' %}">Order History</a></li>
            <li><a class="dropdown-item" href="{% url 'account_settings' %}">Settings</a></li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <form method="post" action="{% url 'logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="dropdown-item">Logout</button>
                    </form>
                </li>
            </ul>
        </li>
    {% else %}
        <li class="nav-item">
            <a class="nav-link" href="{% url 'login' %}">Login</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'register' %}">Sign Up</a>
        </li>
    {% endif %}

    <!-- Basket -->
    <li class="nav-item position-relative">
        <a class="nav-link" href="{% url 'basket_summary' %}">
            <i class="bi bi-basket" style="font-size: 1.5rem;"></i>
            <span class="basket-badge">{{ basket_quantity }}</span>
        </a>
    </li>
</ul>
  </header>
      <!-- Messages -->
<div class="container mt-3">
  {% if messages %}
      {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
      {% endfor %}
  {% endif %}
</div>

<!-- === DELIVERY BANNER === -->
<div id="delivery-banner" class="bg-black text-white">
  <div class="container text-center">
    <h4 class="logo-font my-0 py-2">
      Free delivery on orders over £{{ free_delivery_threshold|default:"50" }}!
    </h4>
  </div>
</div>

<!-- ✅ MOBILE SEARCH BAR WITH MATCHING HEIGHT BUTTON -->
<div class="d-sm-none px-3 mt-2">
  <form class="w-100 d-flex align-items-center" method="get" action="{% url 'shop' %}">
    <input 
      type="search" 
      class="form-control form-control-sm me-2" 
      placeholder="Search" 
      name="q"      
      style="height: 38px; flex-grow: 1;"
    >
    <button 
      class="btn btn-primary btn-sm" 
      type="submit"
      style="height: 38px; width: 80px; min-width: 80px; padding: 0; font-size: 0.75rem;"
    >Go</button>
  </form>
</div>
<!-- === MAIN CONTENT === -->
  <main>
    {% block content %}
    {% endblock %}
  </main>

  {% if messages %}
  <div class="container mt-2">
    {% for message in messages %}
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<!-- Footer -->
<footer class="bg-light text-dark mt-5 pt-3 pb-2 shadow-sm">
  <div class="container">
    <div class="row small">  <!-- makes text smaller -->
      
      <!-- Customer Service -->
      <div class="col-md-3 mb-2">
        <h6 class="fw-bold">Customer Service</h6>
        <ul class="list-unstyled mb-0">
          <li><a href="{% url 'contact' %}" class="footer-link">Contact Us</a></li>
          <li><a href="{% url 'delivery_info' %}" class="footer-link">Delivery Information</a></li>
          <li><a href="{% url 'returns' %}">Returns & Refunds</a></li>
          <li><a href="{% url 'help_faqs' %}" class="footer-link">Help & FAQs</a></li>
        </ul>
      </div>

      <!-- Shop -->
      <div class="col-md-3 mb-2">
        <h6 class="fw-bold">Shop</h6>
        <ul class="list-unstyled mb-0">
          <li><a href="{% url 'shop' %}" class="footer-link">All Products</a></li>
          <li><a href="{% url 'shop' %}?category=" class="footer-link">Categories</a></li>
          <li><a href="{% url 'wishlist' %}" class="footer-link">Wishlist</a></li>
        </ul>
      </div>

<!-- Social Links -->
<div class="col-md-3 mb-2">
  <h6 class="fw-bold">Follow Us</h6>
  <div class="d-flex flex-column">
    <a href="https://www.facebook.com/profile.php?id=61558462015331" 
       target="_blank" 
       class="text-decoration-none d-flex align-items-center mb-1"
       style="color: #1877F2;">
      <i class="bi bi-facebook me-1"></i> Facebook
    </a>
    <a href="https://ebay.us/m/k4GB45" 
       target="_blank" 
       class="text-decoration-none d-flex align-items-center mb-1"
       style="color: #0064D2;">
      <i class="bi bi-bag me-1"></i> eBay
    </a>
  </div>
</div>

<!-- Newsletter -->
<div class="col-md-3 mb-2">
  <h6 class="fw-bold">Stay Connected</h6>
<form method="post" action="{% url 'newsletter:subscribe' %}">
  {% csrf_token %}
  <div class="d-flex flex-column flex-sm-row">
    <input type="email" name="email" class="form-control me-sm-2 mb-2 mb-sm-0"
           placeholder="Email" style="font-size: 0.95rem;" required>
    <button class="btn btn-primary btn-sm d-flex justify-content-center align-items-center"
            type="submit" style="font-size: 0.85rem;">
      <i class="bi bi-envelope-fill me-1"></i> Subscribe
    </button>
  </div>
</form>
</div>

<!-- Bottom -->
    <div class="text-center mt-3 border-top pt-2 small text-muted">
      <p class="mb-0">&copy; {{ year }} Resin Treasures. All rights reserved.</p>
    </div>
  </div>
</footer>

{% if request.resolver_match.url_name != 'wishlist' %}
<a href="{% url 'wishlist' %}" 
   class="btn btn-danger rounded-circle shadow"
   style="position: fixed; bottom: 20px; right: 20px; 
          width: 50px; height: 50px; display: flex; 
          align-items: center; justify-content: center; 
          z-index: 1000;">
   <i class="bi bi-heart-fill"></i>
</a>
{% endif %}

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.getElementById('categoryToggle')?.addEventListener('click', function() {
  document.getElementById('categoryMenu').classList.toggle('show');
});

document.addEventListener('click', function(e) {
  if (!document.querySelector('.categories-dropdown')?.contains(e.target)) {
    document.getElementById('categoryMenu')?.classList.remove('show');
  }
});

document.addEventListener("DOMContentLoaded", function () {
  const searchForm = document.querySelector("form[action='{% url 'shop' %}']");
  if (searchForm) {
    searchForm.addEventListener("submit", function () {
      const input = searchForm.querySelector("input[name='q']");
    });
  }
});
</script>
{% if request.resolver_match.url_name != 'wishlist' %}
<a href="{% url 'wishlist' %}" class="btn btn-danger rounded-circle shadow"
   style="position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; z-index: 1000;">
   <i class="bi bi-heart-fill"></i>
</a>
{% endif %}
</body>
</html>
