{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
  <div class="row">

    <!-- Thumbnails and Main Image -->
    <div class="col-md-6">
      <div class="row">
        <!-- Thumbnails -->
        <div class="col-3">
          {% for variant in variants %}
            {% if variant.image %}
              <img 
                src="{{ variant.image.url }}" 
                class="img-thumbnail mb-2 thumb" 
                style="cursor: pointer;" 
                onclick="switchVariant('{{ variant.image.url }}', '{{ variant.price }}', '{{ variant.description|escapejs }}')"
                alt="Thumbnail for {{ variant.color_name }}"
              >
            {% endif %}
          {% endfor %}
        </div>

        <!-- Main Image -->
        <div class="col-9 text-center">
          {% if variants and variants.0.image %}
            <img id="main-image" src="{{ variants.0.image.url }}" class="img-fluid rounded shadow" style="max-height: 400px;" alt="{{ product.name }}">
          {% else %}
            <img id="main-image" src="{% static 'images/no-image.png' %}" class="img-fluid rounded shadow" style="max-height: 400px;" alt="No image">
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Product Details -->
    <div class="col-md-6">
      <h1 class="mb-3">{{ product.name }}</h1>

      <!-- Color Swatch Selection -->
      <div class="mb-4">
        <strong>Select Color:</strong>
        <div class="d-flex flex-wrap gap-2 mt-2">
          {% for variant in variants %}
            {% if variant.color_list %}
              <button 
                class="border rounded-circle" 
                style="
                  width: 32px; 
                  height: 32px; 
                  {% if variant.color_list|length > 1 %}
                    background: linear-gradient(to right, {% for color in variant.color_list %}{{ color }}{% if not forloop.last %}, {% endif %}{% endfor %});
                  {% else %}
                    background-color: {{ variant.color_list.0 }};
                  {% endif %}
                  border: 2px solid #aaa;
                " 
                title="{{ variant.color_name }}" 
                onclick="switchVariant(
                  {% if variant.image %}'{{ variant.image.url }}'{% else %}''{% endif %},
                  '{{ variant.price }}',
                  '{{ variant.description|escapejs }}')"
              ></button>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Price -->
      {% if variants and variants.0.price %}
        <h3 id="variant-price" class="text-success mb-4">£{{ variants.0.price }}</h3>
      {% else %}
        <h3 class="text-success mb-4">Price not available</h3>
      {% endif %}

      <!-- Description -->
      {% if variants.0.description %}
        <p id="variant-description" class="mb-4">{{ variants.0.description }}</p>
      {% endif %}

      <!-- Action Buttons -->
      <div class="mt-4 text-start">
        <button class="btn btn-primary btn-lg w-auto">Buy it now</button>
        
        <form action="{% url 'add_to_basket' product.id %}" method="post" class="mt-2 d-inline-block">
          {% csrf_token %}
          <button type="submit" class="view-product-btn btn btn-outline-primary w-auto">Add to Basket</button>
        </form>

        <!-- Wishlist Button -->
        <form action="{% url 'add_to_wishlist' product.id %}" method="post" class="mt-2 d-inline-block">
          {% csrf_token %}
          <button type="submit" class="btn btn-outline-secondary w-auto">
            {% if request.user.is_authenticated and product.id in wishlist_ids %}
              ❤️ In Wishlist
            {% else %}
              ♡ Add to Wishlist
            {% endif %}
          </button>
        </form>
      </div>

      <a href="{% url 'shop' %}" class="btn btn-link mt-4">&larr; Back to Shop</a>
    </div>

  </div>
</div>

<script>
  function switchVariant(imageUrl, price, description) {
    if (imageUrl) {
      document.getElementById('main-image').src = imageUrl;
    }
    if (price) {
      document.getElementById('variant-price').innerText = '£' + parseFloat(price).toFixed(2);
    }
    if (description) {
      document.getElementById('variant-description').innerText = description;
    }
  }
</script>
{% endblock %}








